!function(e){"use strict";e.module("multipleDatePicker",[]).directive("multipleDatePicker",["$mdDialog","$translate",function(a,t){return{restrict:"AE",scope:{ngModel:"=?",highlightDays:"=?",dayClick:"=?",dayHover:"=?",rightClick:"=?",month:"=?",monthChanged:"=?",monthClick:"=?",weekDaysOff:"=?",allDaysOff:"=?",daysAllowed:"=?",sundayFirstDay:"=?",disableNavigation:"=?",disallowBackPastMonths:"=?",disallowGoFuturMonths:"=?",showDaysOfSurroundingMonths:"=?",cssDaysOfSurroundingMonths:"=?",fireEventsForDaysOfSurroundingMonths:"=?",disableDaysBefore:"=?",disableDaysAfter:"=?",changeYearPast:"=?",changeYearFuture:"=?",moment:"=?",year:"=?",showAllYear:"=?"},template:'<div class="multiple-date-picker" layout="row" layout-sm="column"><div class="picker-top-row yearWrapper"><div class="text-center picker-navigate picker-navigate-left-arrow" ng-class="{\'disabled\':disableBackButton}" ng-click="changeYear(disableBackButton, -1)">&lt;</div><div class="text-center picker-month"><span>{{year.year()}}</span></div><div class="text-center picker-navigate picker-navigate-right-arrow" ng-class="{\'disabled\':disableNextButton}" ng-click="changeYear(disableNextButton, 1)">&gt;</div></div><div class="copyPastYear" layout="row"><md-fab-speed-dial md-direction="right" class="md-fling"><md-fab-trigger><md-button class="md-fab md-mini zmdi zmdi-calendar" ng-class="currentColorClass" aria-label="Add User"><md-tooltip>{{ "TEXT.CHANGE_CALENDAR" | translate }}</md-tooltip></md-button></md-fab-trigger><md-fab-actions><md-button ng-click="changeGroupColor(\'red\')" class="md-fab md-mini zmdi zmdi-calendar multipleDatePicker-red" aria-label="Add User"></md-button><md-button ng-click="changeGroupColor(\'green\')" class="md-fab md-mini zmdi zmdi-calendar multipleDatePicker-green" aria-label="Add User"></md-button><md-button ng-click="changeGroupColor(\'blue\')" class="md-fab md-mini zmdi zmdi-calendar multipleDatePicker-blue" aria-label="Add User"></md-button></md-fab-actions></md-fab-speed-dial><div><md-button class="md-fab md-mini zmdi zmdi-copy" ng-click="copyPreviousYear()"><md-tooltip>{{"TEXT.COPY_PREVIOUS_YEAR" | translate}}</md-tooltip></md-button></div></div><div class="monthWrapper" ng-repeat="month in months"><div class="picker-top-row"><div class="text-center picker-month">{{month.monthToDisplay}} </div></div><div class="picker-days-week-row"><div class="text-center" ng-repeat="day in daysOfWeek">{{day}}</div></div><div class="picker-days-row"><div class="text-center picker-day {{day.classes}} current{{currentColorGroup}}" title="{{day.title}}" ng-repeat="day in month.days" ng-click="toggleDay($event, day)" ng-mouseover="hoverDay($event, day)" ng-mouseleave="dayHover($event, day)" mdp-right-click="rightClicked($event,day)">{{day ? day.mdp.otherMonth && !showDaysOfSurroundingMonths ? \'&nbsp;\' : day.date.format(\'D\') : \'\'}}</div></div></div></div>',link:function(r){var n=window.moment||r.moment,o=r.year||n();r.ngModel=r.ngModel||i();var d=function(){var e=n(),a=n(r.month).subtract(1,"year"),t=n(r.month).add(1,"year"),o=n().add(1,"year");r.previousYear=a.format("YYYY"),r.nextYear=t.format("YYYY"),r.disableBackButton=e.isAfter(a,"year"),r.disableNextButton=o.isBefore(t,"year")},i=function(){r.ngModel[o.year()]||(r.ngModel[o.year()]={red:[],green:[],blue:[]}),r.ngModel[o.year()].red||(r.ngModel[o.year()].red=[]),r.ngModel[o.year()].green||(r.ngModel[o.year()].green=[]),r.ngModel[o.year()].blue||(r.ngModel[o.year()].blue=[])},s=function(){n.locale("es");for(var e=n().localeData()._weekdaysMin,a=[],t=1;t<7;t++)a.push(e[t]);return r.sundayFirstDay?a.splice(0,0,e[0]):a.push(e[0]),a},l=function(a){var t=n(a).date(0).day(r.sundayFirstDay?0:1).subtract(1,"day");n(a).date(0).diff(t,"day")>6&&(t=t.add(1,"week"));var o=n(a).date(1),i=[],s=n(),l=n(o).endOf("month"),c=function(){var o={date:n(t.add(1,"day")),mdp:{selected:!1}};if(e.isArray(r.highlightDays)){var d=r.highlightDays.filter(function(e){return o.date.isSame(e.date,"day")});o.css=d.length>0?d[0].css:"",o.title=d.length>0?d[0].title:""}return o.selectable=!r.isDayOff(o),o.mdp.selected=r.isSelected(o),o.mdp.selected&&r.getColorGroup(o),o.mdp.today=o.date.isSame(s,"day"),o.mdp.past=o.date.isBefore(s,"day"),o.mdp.future=o.date.isAfter(s,"day"),o.date.isSame(a,"month")||(o.mdp.otherMonth=!0),o.classes=r.getDayClasses(o),o},y=l.diff(t,"days"),u=r.sundayFirstDay?6:0;l.day()!==u&&(y+=(r.sundayFirstDay?6:7)-l.day());for(var f=0;f<y;f++)i.push(c());return d(),i};r.months=[],r.month=n().startOf("day"),r.year=n().startOf("year"),r.days=[],r.weekDaysOff=r.weekDaysOff||[],r.daysOff=r.daysOff||[],r.disableBackButton=!0,r.disableNextButton=!1,r.daysOfWeek=s(),r.cssDaysOfSurroundingMonths=r.cssDaysOfSurroundingMonths||"picker-empty",r.yearsForSelect=[],r.currentColorGroup="red",r.currentColorClass="multipleDatePicker-red",r.availableColorGroups=["red","green","blue"],r.toggleDay=function(a,t){if(a.preventDefault(),!t.mdp.otherMonth||r.fireEventsForDaysOfSurroundingMonths){var o=!1;if(a.preventDefault=function(){o=!0},"function"==typeof r.dayClick&&r.dayClick(a,t),t.selectable&&!o){if(t.mdp.selected=!t.mdp.selected,t.mdp.selected)t.mdp.colorGroup=r.currentColorGroup,r.ngModel[r.year.year()][r.currentColorGroup].push(t.date);else{var d=-1;e.forEach(r.availableColorGroups,function(e){for(var a=0;a<r.ngModel[r.year.year()][e].length;++a)if(n.isMoment(r.ngModel[r.year.year()][e][a])){if(r.ngModel[r.year.year()][e][a].isSame(t.date,"day")){d=a;break}}else if(t.date.isSame(r.ngModel[r.year.year()][e][a],"day")){d=a;break}d!==-1&&r.ngModel[r.year.year()][e].splice(d,1)})}t.classes=r.getDayClasses(t)}}},r.hoverDay=function(e,a){e.preventDefault();var t=!1;e.preventDefault=function(){t=!0},"function"==typeof r.dayHover&&r.dayHover(e,a),t||(a.mdp.hover="mouseover"===e.type)},r.changeGroupColor=function(e){r.currentColorGroup=e,r.currentColorClass="multipleDatePicker-"+e},r.groupActiveClass=function(e){if(e===r.currentColorGroup)return"active"},r.getColorGroup=function(a){var t=!1;e.forEach(r.availableColorGroups,function(e){if(r.ngModel[r.year.year()][e]&&(t=r.ngModel[r.year.year()][e].some(function(e){return a.date.isSame(e,"day")})))return void(a.mdp.colorGroup=e)})},r.copyPreviousYear=function(){var e=r.year.year()-1;r.ngModel[e]?(alert=a.confirm().title(t.instant("TEXT.SAVED_TITLE")).content(t.instant("TEXT.SAVED_MESSAGE")).ok(t.instant("TEXT.ACCEPT")).cancel(t.instant("TEXT.CANCEL")),a.show(alert).then(function(){c(e)},function(){console.log("Rechazado")})):(alert=a.alert().title(t.instant("TEXT.ERROR")).content(t.instant("QUEUE.LINEAR_ERROR")).ok(t.instant("TEXT.ACCEPT")),a.show(alert)["finally"]())};var c=function(a){r.ngModel[r.year.year()]=e.copy(r.ngModel[a]),e.forEach(r.availableColorGroups,function(e){for(var a in r.ngModel[r.year.year()][e])n.isMoment(r.ngModel[r.year.year()][e][a])?r.ngModel[r.year.year()][e][a].add(1,"year"):r.ngModel[r.year.year()][e][a]=n(r.ngModel[r.year.year()][e][a]).add(1,"year")}),r.generate()};r.rightClicked=function(e,a){"function"==typeof r.rightClick&&(e.preventDefault(),r.rightClick(e,a))},r.getDayClasses=function(e){var a="";return!e.css||e.mdp.otherMonth&&!r.showDaysOfSurroundingMonths||(a+=" "+e.css),r.cssDaysOfSurroundingMonths&&e.mdp.otherMonth&&(a+=" "+r.cssDaysOfSurroundingMonths),e.mdp.selected&&(a+=" picker-selected"),e.selectable||(a+=" picker-off"),e.mdp.today&&(a+=" today"),e.mdp.past&&(a+=" past"),e.mdp.future&&(a+=" future"),e.mdp.otherMonth&&(a+=" picker-other-month"),e.mdp.colorGroup&&(a+=" "+e.mdp.colorGroup),a},r.changeYear=function(e,a){if(!e){event.preventDefault();var t=n(r.month).add(a,"year");r.year=t,r.month=t.startOf("month"),r.generate()}},r.changeMonth=function(e,a,t){if(!a){e.preventDefault();var o=!1;e.preventDefault=function(){o=!0};var d=n(r.month).add(t,"month");if("function"==typeof r.monthClick&&r.monthClick(e,d),!o){var i=n(r.month);r.month=d,"function"==typeof r.monthChanged&&r.monthChanged(r.month,i)}}},r.isDayOff=function(a){return r.allDaysOff||!!r.disableDaysBefore&&n(a.date).isBefore(r.disableDaysBefore,"day")||!!r.disableDaysAfter&&n(a.date).isAfter(r.disableDaysAfter,"day")||e.isArray(r.weekDaysOff)&&r.weekDaysOff.some(function(e){return a.date.day()===e})||e.isArray(r.daysOff)&&r.daysOff.some(function(e){return a.date.isSame(e,"day")})||e.isArray(r.daysAllowed)&&!r.daysAllowed.some(function(e){return a.date.isSame(e,"day")})||e.isArray(r.highlightDays)&&r.highlightDays.some(function(e){return a.date.isSame(e.date,"day")&&!e.selectable})},r.isSelected=function(a){var t=!1;return e.forEach(r.availableColorGroups,function(e){t||r.ngModel[r.year.year()][e]&&(t=r.ngModel[r.year.year()][e].some(function(e){return a.date.isSame(e,"day")}))}),t},r.generate=function(){n.locale("es");var e=n().year(r.year.year());r.months=[];for(var a=0;a<12;a++){var t=e.month(a),o={year:e.year().toString(),monthToDisplay:e.format("MMMM"),days:l(t)};r.months.push(o)}d()},r.generate(),r.groupActiveClass()}}}])}(window.angular);